<div class="flex flex-col">
  <!-- Contenido principal -->
  <div class="flex-grow mt-6">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold mb-4 text-[#6a1b1b]">
        Registrar fichas por carrera
      </h2>

      <form (ngSubmit)="registrarFichas()" #fichasForm="ngForm">
        <!-- Encabezados -->
        <div class="grid grid-cols-7 font-semibold border-b pb-2 mb-2 items-center relative">
          <div class="col-span-2">Carrera</div>
          <div *ngIf="hasRole('ROLE_ADMIN')">Nuevo límite</div>
          <div>Límite actual</div>
          <div>Inscritos</div>
          <div>Disponibles</div>
          <div>Ciclo escolar</div>
        </div>

        <!-- Select alineado a la 6ta columna -->
        <div class="grid grid-cols-6 mb-4">
          <div *ngIf="hasRole('ROLE_ADMIN')" class="col-start-6">
            <select [(ngModel)]="anioSeleccionado" name="anio" (change)="onAnioChange()" class="block w-28 px-3 py-1 border border-gray-300 rounded-md shadow-sm
      focus:outline-none focus:ring-[#6a1b1b] focus:border-[#6a1b1b]" required>
              <option *ngFor="let anio of anios" [value]="anio">{{ anio }}</option>
            </select>
          </div>
          <div *ngIf="hasRole('ROLE_USER')" class="col-start-5">
            <select [(ngModel)]="anioSeleccionado" name="anio" (change)="onAnioChange()" class="block w-28 px-3 py-1 border border-gray-300 rounded-md shadow-sm
      focus:outline-none focus:ring-[#6a1b1b] focus:border-[#6a1b1b]" required>
              <option *ngFor="let anio of anios" [value]="anio">{{ anio }}</option>
            </select>
          </div>
        </div>


        <!-- Filas -->
        <div class="grid grid-cols-7 gap-x-8 gap-y-4" *ngFor="let carrera of carreras">
          <!-- Nombre carrera ocupa dos columnas -->
          <div class="flex items-center col-span-2">{{ carrera.label }}</div>

          <!-- Input editable -->
          <input placeholder="0" *ngIf="hasRole('ROLE_ADMIN')" type="number" [id]="carrera.key" name="{{ carrera.key }}"
            [value]="fichas[carrera.key] || ''" (input)="onInputChange($event, carrera.key)" class="mt-1 block w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm
                   focus:outline-none focus:ring-[#6a1b1b] focus:border-[#6a1b1b]" min="0" />

          <!-- Límite actual solo lectura -->
          <input type="number" [value]="limitesActuales[carrera.key]" readonly class="mt-1 block w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm
                   bg-gray-100 text-gray-600 cursor-not-allowed" />

          <!-- Inscritos -->
          <input type="number" [value]="inscritos[carrera.key]" readonly class="mt-1 block w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm
                             bg-gray-100 text-gray-600 cursor-not-allowed" />

          <!-- Disponibles -->
          <input type="number" [value]="disponibles[carrera.key]" readonly class="mt-1 block w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm
                   bg-gray-100 text-gray-600 cursor-not-allowed" />

          <!-- Columna vacía para alinear ciclo escolar -->
          <div></div>
        </div>





        <div class="mt-4 text-right text-sm text-gray-600">
          Año seleccionado: <span class="font-semibold text-[#6a1b1b]">{{ anioSeleccionado }}</span>
        </div>

        <button *ngIf="hasRole('ROLE_ADMIN')" type="submit" [disabled]="!fichasForm.form.valid || cargando" class="mt-6 px-4 py-2 rounded text-white transition flex items-center justify-center gap-2
         bg-[#548e88] hover:bg-[#29726b]
         disabled:bg-gray-400 disabled:cursor-not-allowed">
          <ng-container *ngIf="!cargando; else loading">
            Registrar Fichas
          </ng-container>

          <ng-template #loading>
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
              viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            Enviando...
          </ng-template>
        </button>


      </form>
    </div>
  </div>
</div>

<!-- Modal de confirmación -->
<!-- Modal de confirmación adaptado a tu estándar -->
<!-- Icono que quieras mostrar -->
<app-confirm-dialog *ngIf="showConfirmModal" [message]="confirmMessage" [title]="'Confirmación'"
  (confirm)="confirmCallback && confirmCallback()" (cancel)="showConfirmModal = false">
</app-confirm-dialog>