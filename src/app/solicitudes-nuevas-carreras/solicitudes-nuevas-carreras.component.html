<div class="w-full flex justify-center mt-6 px-2">
  <div class="w-full bg-white rounded-lg shadow-md overflow-hidden">

    <!-- Encabezado -->
    <div class="p-6 bg-[#24645c] text-white">
      <h2 class="text-2xl font-semibold">Solicitudes de cambio de carrera</h2>
    </div>

    <!-- Mensajes cuando no hay datos -->
    <div *ngIf="filteredData.length === 0" class="p-8 text-center text-gray-500">
      No hay solicitudes disponibles
    </div>

    <!-- Tabla scrollable -->
    <div *ngIf="filteredData.length > 0" class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-[#14645c]">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Id</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Ficha</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Carrera adscrita
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Carrera Solicitada
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Comentario del
              aspirante</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Estado</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <!-- üîπ usamos paginatedData -->
          <tr *ngFor="let solicitud of paginatedData">
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ solicitud.id }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ solicitud.ficha }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ solicitud.antiguacarrera }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ solicitud.nuevaCarrera }}</td>
            <td class="px-6 py-4 text-sm text-gray-900 whitespace-pre-line">
              {{ obtenerTextoVisible(solicitud) }}

              <button *ngIf="tieneMasDeDosRenglones(solicitud.comentario)" (click)="toggleVerMas(solicitud)"
                class="text-blue-600 text-xs mt-1 block hover:underline">
                {{ solicitud.verMas ? 'Ver menos' : 'Ver m√°s' }}
              </button>
            </td>


            <td class="px-6 py-4 whitespace-nowrap">
              <span [ngClass]="{
                'bg-green-100 text-green-800': solicitud.estado === 'Aprobada',
                'bg-red-100 text-red-800': solicitud.estado === 'Rechazada',
                'bg-yellow-100 text-yellow-800': solicitud.estado === 'Pendiente'
              }" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                {{ solicitud.estado }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <button class="text-white bg-[#548e88] hover:bg-green-700 mr-2 px-3 py-1 rounded shadow-sm"
                (click)="abrirModal(solicitud.id)">
                Atender
              </button>
            </td>
          </tr>

          <!-- üîπ Filas vac√≠as -->
          <tr *ngFor="let _ of emptyRows">
            <td colspan="7" class="px-6 py-5">&nbsp;</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- üîπ Paginaci√≥n estilo ‚ÄúResultados de aspirantes‚Äù -->
    <div *ngIf="filteredData.length > 0" class="px-3 py-3 border-t">
      <div class="flex flex-col items-center gap-2">
        <div class="text-sm text-gray-500 text-center">
          Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }}
          a {{ Math.min(currentPage * itemsPerPage, filteredData.length) }}
          de {{ filteredData.length }} resultados
        </div>

        <div class="flex gap-1 items-center justify-center">
          <button (click)="paginaAnterior()" [disabled]="currentPage === 1"
            class="px-3 py-1 border rounded text-[#14645c] hover:bg-[#f3f4f6] disabled:opacity-50">
            Anterior
          </button>

          <ng-container *ngFor="let page of pages">
            <button *ngIf="page !== '...'; else dots" (click)="goToPage(+page)"
              [class.bg-[#14645c]]="page === currentPage" [class.text-white]="page === currentPage"
              class="px-3 py-1 border rounded hover:bg-[#f3f4f6]">
              {{ page }}
            </button>
            <ng-template #dots>
              <span class="px-2">‚Ä¶</span>
            </ng-template>
          </ng-container>

          <button (click)="siguientePagina()" [disabled]="currentPage === totalPages"
            class="px-3 py-1 border rounded text-[#14645c] hover:bg-[#f3f4f6] disabled:opacity-50">
            Siguiente
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div *ngIf="modalVisible" class="fixed inset-0 flex items-center justify-center z-50"
  style="background-color: rgba(0, 0, 0, 0.474);">
  <div class="bg-white p-6 rounded shadow-lg w-96">
    <h3 class="text-lg font-semibold mb-4">Responder solicitud</h3>
    <textarea [(ngModel)]="comentarioSecretaria"
      placeholder="Escribe un comentario a la respuesta   de la solicitud del aspirante"
      class="w-full p-2 border rounded mb-4 placeholder-gray-400"></textarea>
    <div class="flex justify-end gap-2">
      <button (click)="enviarRespuesta('RECHAZADO')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
        Rechazar
      </button>
      <button (click)="enviarRespuesta('ACEPTADO')"
        class=" bg-[#548e88] text-white rounded hover:bg-[#29726b] px-4 py-2 ">
        Aceptar
      </button>
      <button (click)="cerrarModal()" class="ml-2 text-gray-600 hover:text-gray-900">Cancelar</button>
    </div>
  </div>
</div>