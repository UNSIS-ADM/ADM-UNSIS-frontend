<!-- confirm dialog: se mostrará solo cuando dialogVisible = true -->
<app-confirm-dialog *ngIf="dialogVisible" [title]="dialogTitle" [message]="dialogMessage" (confirm)="onDialogConfirm()"
    (cancel)="onDialogCancel()">
</app-confirm-dialog>

<!-- snackbar -->
<div *ngIf="snackbarVisible" class="fixed bottom-6 right-6 z-50 px-4 py-2 rounded-lg text-white shadow"
    style="background: rgba(41,114,107,0.95);">
    {{ snackbarMessage }}
</div>


<div class="p-6 max-w-7xl mx-auto">
    <!--
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Administración de Usuarios</h1>
        <button class="bg-[#29726b] hover:bg-[#548e88] text-white px-4 py-2 rounded-xl shadow" (click)="newUser()">
            <svg class="w-5 h-5 inline-block mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14" stroke="white" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            ➕ Nuevo usuario
        </button>
    </div>-->
    
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-shadow-gray-900">Administración de Usuarios</h1>
        <button class="bg-[#29726b] hover:bg-[#548e88] text-white px-4 py-2 rounded-xl shadow" (click)="newUser()">
            <svg class="w-5 h-5 inline-block mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14" stroke="white" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Nuevo usuario
        </button>
    </div>

    <!-- Tabla -->
    <div class="bg-white rounded-xl shadow overflow-hidden">
        <table class="w-full text-sm">
            <thead class="bg-gray-100">
                <tr>
                    <th class="p-3 text-left">Usuario</th>
                    <th class="p-3 text-left">Nombre</th>
                    <th class="p-3 text-left">Roles</th>
                    <th class="p-3 text-center">Estado</th>
                    <th class="p-3 text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let u of users" class="border-t hover:bg-gray-50">
                    <td class="p-3 font-medium">{{ u.username }}</td>
                    <td class="p-3">{{ u.fullName }}</td>
                    <td class="p-3">
                        <span *ngFor="let r of u.roles"
                            class="text-xs bg-indigo-100 text-[#6a1b1b] hover:bg-[#bfd2d0] px-2 py-1 rounded mr-1">
                            {{ r }}
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold"
                            [ngClass]="u.active ? 'bg-green-100 text-[#29726b]' : 'bg-red-100 text-red-700'">
                            {{ u.active ? 'Activo' : 'Inactivo' }}
                        </span>
                    </td>
                    <td class="p-3 text-center space-x-2">
                        <button class="text-[#29726b] hover:underline" (click)="edit(u)">Editar</button>
                        <button class="text-[#6a1b1b] hover:underline" (click)="toggle(u)">
                            {{ u.active ? 'Desactivar' : 'Activar' }}
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Modal -->
    <div *ngIf="showForm" class="fixed inset-0 bg-black/40 flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-6">
            <h2 class="text-xl font-semibold mb-4">
                {{ form.id ? 'Editar Usuario' : 'Nuevo Usuario' }}
            </h2>

            <div class="space-y-4">
                <input class="w-full border rounded-lg p-2" placeholder="Username" [(ngModel)]="form.username">
                <input class="w-full border rounded-lg p-2" placeholder="Nombre completo" [(ngModel)]="form.fullName">
                <input type="password" class="w-full border rounded-lg p-2" placeholder="Password" [(ngModel)]="form.password">
                <input type="password" class="w-full border rounded-lg p-2" placeholder="Confirmar password"
                    [(ngModel)]="confirmPassword">

                <div class="flex gap-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" (change)="toggleRole('ROLE_ADMIN')" [checked]="hasRole('ROLE_ADMIN')">
                        Administrador
                    </label>

                    <label class="flex items-center gap-2">
                        <input type="checkbox" (change)="toggleRole('ROLE_USER')" [checked]="hasRole('ROLE_USER')">
                        Secretaria
                    </label>
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-6">
                <button class="px-4 py-2 rounded-lg border" (click)="showForm = false">
                    Cancelar
                </button>
                <button class="px-4 py-2 rounded-lg bg-[#29726b] text-white" (click)="save()">
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>