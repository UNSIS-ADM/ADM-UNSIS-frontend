<div class="p-4 max-w-6xl mx-auto">
    <h2 class="text-xl font-bold mb-4">Administrador de contenidos</h2>
    <div class="flex gap-6">
        <!-- LEFT: lista -->
        <div class="w-1/3 border p-3 rounded bg-white" [style.borderColor]="'#14645c'">
            <div class="flex justify-between items-center mb-2">
                <strong>Contenidos</strong>
                <button (click)="select()" class="px-2 py-1 bg-[#14645c] text-white rounded">Nuevo</button>
            </div>
            <div *ngIf="loadingList">Cargando...</div>
            <ul *ngIf="!loadingList" class="space-y-2 max-h-[60vh] overflow-auto">
                <li *ngFor="let item of list"
                    class="p-2 border rounded bg-white cursor-pointer transform transition-shadow duration-150 ease-in-out hover:shadow-md hover:-translate-y-0.5"
                    (click)="select(item)">
                    <div class="font-medium">{{ item.keyName }}</div>
                    <div class="text-sm text-gray-600">{{ item.title }}</div>
                </li>
            </ul>
        </div>

        <!-- RIGHT: editor -->
        <div class="w-2/3 border p-4 rounded space-y-3 bg-white" [style.borderColor]="'#6a1b1b'">
            <form [formGroup]="form" (ngSubmit)="save()">
                <div class="flex items-center justify-between">
                    <!-- Key oculto (no editable) -->
                    <div *ngIf="false">
                        <label class="block text-sm">Key</label>
                        <input type="text" formControlName="keyName"
                            class="border p-1 rounded w-64 bg-white transition-shadow duration-150 focus:shadow-md focus:outline-none"
                            readonly />
                    </div>

                    <!-- Activo -->
                    <div>
                        <label class="block text-sm">Activo</label>
                        <input type="checkbox" formControlName="active" class="accent-[#14645c]" />
                    </div>
                </div>

                <!-- Title: visible pero no editable -->
                <div>
                    <label class="block text-sm">Título</label>
                    <div class="border p-2 rounded bg-white text-gray-800 transition-shadow duration-150">
                        {{ form.get('title')?.value || '—' }}
                    </div>
                </div>

                <!-- Datos de contacto (editables) -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm">Teléfono</label>
                        <input type="text" formControlName="phone"
                            class="border p-1 rounded w-full bg-white transition-shadow duration-150 focus:shadow-md focus:outline-none hover:shadow-sm" />
                    </div>
                    <div>
                        <label class="block text-sm">Email de contacto</label>
                        <input type="email" formControlName="email"
                            class="border p-1 rounded w-full bg-white transition-shadow duration-150 focus:shadow-md focus:outline-none hover:shadow-sm" />
                    </div>
                </div>

                <!-- Partes -->
                <div formArrayName="parts" class="mt-3">
                    <div *ngFor="let partCtrl of partsArray.controls; let i = index" [formGroupName]="i"
                        class="mb-4 border p-2 rounded bg-white transform transition-all duration-150 hover:shadow-md hover:-translate-y-0.5"
                        [style.borderLeft]="'4px solid ' + (i % 2 === 0 ? '#14645c' : '#6a1b1b')">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <label class="block text-xs font-semibold">Clave</label>
                                <div class="text-sm">{{ partCtrl.get('partKey')?.value }}</div>
                            </div>

                            <!-- Orden oculto -->
                            <div class="hidden">
                                <label class="block text-xs">Orden</label>
                                <input type="number" formControlName="orderIndex" class="border p-1 w-20 bg-white" />
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm">Título sección</label>
                            <input formControlName="title"
                                class="border p-1 w-full bg-white transition-shadow duration-150 focus:shadow-md focus:outline-none" />
                        </div>

                        <div class="mt-2">
                            <label class="block text-sm">HTML (editar)</label>
                            <textarea formControlName="htmlContent" rows="6"
                                class="border p-2 w-full bg-white transition-shadow duration-150 focus:shadow-md focus:outline-none"
                                (input)="updatePreview()"></textarea>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2 mt-2">
                    <button type="submit" [disabled]="saving"
                        class="px-3 py-1 bg-[#14645c] text-white rounded transition-transform duration-150 hover:scale-[1.02]">
                        {{ saving ? 'Guardando...' : 'Guardar' }}
                    </button>
                    <!--
                    <button type="button" (click)="resetForm()"
                        class="px-3 py-1 bg-red-600 text-white rounded transition-transform duration-150 hover:scale-[1.02]">
                        Limpiar
                    </button>
                    -->

                    <span class="text-sm text-green-700 ml-3">{{ message }}</span>
                </div>
            </form>

            <div>
                <h4 class="font-semibold">Previsualización</h4>
                <div class="border p-3 mt-2 bg-white" [innerHTML]="previewSafeHtml"></div>
            </div>
        </div>
    </div>
</div>